
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Correlations at Sea &#8212; Reproducible workflows using the Pyleoclim package</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b76e3c8a" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=87e54e7c" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'CrystalCorrelations/CrystalCorrelations';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Model-Data Confrontation in the Spectral Domain" href="../MDConfrontation/Model_data_confrontation.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../README.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Reproducible workflows using the Pyleoclim package - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Reproducible workflows using the Pyleoclim package - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../README.html">
                    Reproducible workflows using the Pyleoclim package
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Scientific Workflows</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../OrbitalCycles/Chasing_orbital_cyclicities.html">Chasing cyclicities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../MDConfrontation/Model_data_confrontation.html">Model-Data Confrontation in the Spectral Domain</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Correlations at Sea</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/LinkedEarth/PyleoclimPaper/main?urlpath=tree/CrystalCorrelations/CrystalCorrelations.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/LinkedEarth/PyleoclimPaper" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/LinkedEarth/PyleoclimPaper/issues/new?title=Issue%20on%20page%20%2FCrystalCorrelations/CrystalCorrelations.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/CrystalCorrelations/CrystalCorrelations.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Correlations at Sea</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data">Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-exploration">Data Exploration</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sea-surface-temperature">Sea-surface Temperature</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pitfall-1-persistence">Pitfall #1: Persistence</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#null-models">Null Models</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#timeseries-alignment">Timeseries Alignment</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pitfall-2-multiple-hypothesis-testing">Pitfall #2: Multiple Hypothesis Testing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pitfall-3-age-uncertainties">Pitfall #3: Age uncertainties</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion">Conclusion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <img src='https://github.com/LinkedEarth/Logos/raw/master/PYLEOCLIM_logo_HORZ-01.png' width="800">
<section class="tex2jax_ignore mathjax_ignore" id="correlations-at-sea">
<h1>Correlations at Sea<a class="headerlink" href="#correlations-at-sea" title="Link to this heading">#</a></h1>
<p>Correlation analysis, despite its simplicity and many shortcomings, remains a centerpiece of empirical analysis in many fields, particularly the paleosciences. Computing correlations is trivial enough; the difficulty lies in properly assessing their significance. Of particular importance are four considerations:</p>
<ol class="arabic simple">
<li><p><strong>Persistence</strong>, which violates the standard assumption that the data are independent (which underlies the classical test of significance implemented, e.g. in Excel).</p></li>
<li><p><strong>Time irregularities</strong>, for instance comparing two records with different time axes, possibly unevenly spaced (which standard software cannot deal with out of the box)</p></li>
<li><p><strong>Age uncertainties</strong>, for example comparing two records, each with an ensemble of plausible chronologies (generated, for instance, by a Bayesian age model)</p></li>
<li><p><strong>Test multiplicity</strong> aka the “Look Elsewhere effect”, which states that repeatedly performing the same test can result in unacceptably high type I error (accepting correlations as significant, when in fact they are not). This arises e.g. when correlating a paleoclimate record with an instrumental field, assessing significance at thounsands of grid points at once, or assessing significance within an age ensemble.</p></li>
</ol>
<p>In this notebook we reproduce the study of <a class="reference external" href="http://dx.doi.org/10.1016/j.epsl.2016.11.048">Hu et al, 2017</a>, particularly the example of their section 4, which illustrates several of these pitfalls at once. The example illuminates the issue of relying too strongly on correlations between a paleoclimate record and an instrumental field to interpret the record. Before we start, a disclaimer: the studies investigated in this paper are by no means isolated cases. They just happened to be cases that we knew about, and thought deserved a second look in light of more rigorous statistics. The same study could have been written by subsituting any number of other records interpreted, wholly or in part, on the basis of correlations. Accordingly, what follows should not be viewed as an indictment of a particularly study or group of authors, rather, at how easy it is by the best-intentioned scientists to get fooled by spurious correlations. Accordingly, Pyleoclim facilitates an assessment of correlations that deals with all these cases, makes the necessary data transformations transparent to the user, and allows for one-line plot commands to visualize the results.</p>
<section id="data">
<h2>Data<a class="headerlink" href="#data" title="Link to this heading">#</a></h2>
<p>The example uses the speleothem record of <a class="reference external" href="https://www.nature.com/articles/ngeo1862">McCabe-Glynn et al. (2013)</a> from Crystal Cave, California, in the Sequoia National Forest.  Of interest to us is the <span class="math notranslate nohighlight">\(\delta^{18}O\)</span> record, which the authors interpret as reflecting sea-surface temperatures (SST) in the Kuroshio Extension region of the West Pacific. This is a strong claim, given that no mechanistic link is proposed,  and relies entirely on an analysis of correlations between the record and instrumental SST.</p>
</section>
<section id="data-exploration">
<h2>Data Exploration<a class="headerlink" href="#data-exploration" title="Link to this heading">#</a></h2>
<p>We start by loading a few useful packages:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">pyleoclim</span> <span class="k">as</span> <span class="nn">pyleo</span>
<span class="kn">from</span> <span class="nn">pylipd</span> <span class="kn">import</span> <span class="n">LiPD</span>
<span class="n">pyleo</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s1">&#39;web&#39;</span><span class="p">)</span>  <span class="c1"># set the visual style</span>
</pre></div>
</div>
</div>
</div>
<p>We can use the <a class="reference external" href="https://pylipd.readthedocs.io/en/latest/"><code class="docutils literal notranslate"><span class="pre">PyliPD</span></code> package</a> to open the file and select the appropriate timeseries.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">D</span> <span class="o">=</span> <span class="n">D</span> <span class="o">=</span> <span class="n">LiPD</span><span class="p">()</span>
<span class="n">D</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;./data/Crystal.McCabe-Glynn.2013.lpd&#39;</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">get_timeseries_essentials</span><span class="p">()</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Loading 1 LiPD files
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|█████████████████████████████████████████████| 1/1 [00:00&lt;00:00,  2.44it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Loaded..
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dataSetName</th>
      <th>archiveType</th>
      <th>geo_meanLat</th>
      <th>geo_meanLon</th>
      <th>geo_meanElev</th>
      <th>paleoData_variableName</th>
      <th>paleoData_values</th>
      <th>paleoData_units</th>
      <th>paleoData_proxy</th>
      <th>paleoData_proxyGeneral</th>
      <th>time_variableName</th>
      <th>time_values</th>
      <th>time_units</th>
      <th>depth_variableName</th>
      <th>depth_values</th>
      <th>depth_units</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Crystal.McCabe-Glynn.2013</td>
      <td>Speleothem</td>
      <td>36.59</td>
      <td>-118.82</td>
      <td>1386.0</td>
      <td>d18o</td>
      <td>[-8.01, -8.23, -8.61, -8.54, -8.6, -9.08, -8.9...</td>
      <td>permil</td>
      <td>None</td>
      <td>None</td>
      <td>age</td>
      <td>[2007.7, 2007.0, 2006.3, 2005.6, 2004.9, 2004....</td>
      <td>yr AD</td>
      <td>depth</td>
      <td>[0.05, 0.1, 0.15, 0.2, 0.25, 0.3, 0.35, 0.4, 0...</td>
      <td>mm</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Let’s create a <a class="reference external" href="https://pyleoclim-util.readthedocs.io/en/latest/core/api.html#pyleoclim.core.geoseries.GeoSeries"><code class="docutils literal notranslate"><span class="pre">GeoSeries</span></code> object</a>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cc</span> <span class="o">=</span> <span class="n">pyleo</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time_values&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">value</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;paleoData_values&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">lat</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;geo_meanLat&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                     <span class="n">lon</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;geo_meanLon&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">elevation</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;geo_meanElev&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">time_name</span><span class="o">=</span> <span class="s1">&#39;Age&#39;</span><span class="p">,</span> <span class="n">time_unit</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;time_units&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                     <span class="n">value_name</span> <span class="o">=</span> <span class="s1">&#39;$\delta^</span><span class="si">{18}</span><span class="s1">O$&#39;</span><span class="p">,</span> <span class="n">value_unit</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u2030</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;dataSetName&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> 
                     <span class="n">archiveType</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;archiveType&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">depth</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;depth_values&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> 
                     <span class="n">depth_name</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;depth_variableName&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">depth_unit</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;depth_units&#39;</span><span class="p">],</span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s do a quick plot to check that we have what we want:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/e08953335b214bee7e43d4b2bad83bb66464715c2a0349e8b864e76f8249dbfe.png" src="../_images/e08953335b214bee7e43d4b2bad83bb66464715c2a0349e8b864e76f8249dbfe.png" />
</div>
</div>
<p>Let’s create a <a class="reference external" href="https://pyleoclim-util.readthedocs.io/en/latest/core/api.html#pyleoclim.core.geoseries.GeoSeries.dashboard">dashboard</a>, which provides an overview of the timeseries, the location of the record and spectral peaks.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cc</span><span class="o">.</span><span class="n">dashboard</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Performing spectral analysis on individual series: 100%|█| 200/200 [00:15&lt;00:00,
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 1100x800 with 4 Axes&gt;,
 {&#39;ts&#39;: &lt;Axes: xlabel=&#39;Time [yr AD]&#39;, ylabel=&#39;$\\delta^{18}O$ [‰]&#39;&gt;,
  &#39;dts&#39;: &lt;Axes: xlabel=&#39;Counts&#39;&gt;,
  &#39;map&#39;: {&#39;map&#39;: &lt;GeoAxes: xlabel=&#39;lon&#39;, ylabel=&#39;lat&#39;&gt;},
  &#39;spec&#39;: &lt;Axes: xlabel=&#39;Period [yr]&#39;, ylabel=&#39;PSD&#39;&gt;})
</pre></div>
</div>
<img alt="../_images/cc63466822da5415f64f26eb7faed2eb0745d9e4308e140ad5002fafd11a68c9.png" src="../_images/cc63466822da5415f64f26eb7faed2eb0745d9e4308e140ad5002fafd11a68c9.png" />
</div>
</div>
<p>This is a very high resolution record, with near-annual spacing (check it), and a broadly red spectrum that exhibits a number of spectral peaks at interannual and decadal scales.</p>
<section id="sea-surface-temperature">
<h3>Sea-surface Temperature<a class="headerlink" href="#sea-surface-temperature" title="Link to this heading">#</a></h3>
<p>The original paper correlated the above record against the Kaplan SST dataset.  In this notebook we instead use the <a class="reference external" href="https://www.metoffice.gov.uk/hadobs/hadsst4/index.html">HadSST4 dataset</a> (Morice et al, 2012),  which is more up to date, and which we first download via <code class="docutils literal notranslate"><span class="pre">wget</span></code>. (~8Mb)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>wget<span class="w"> </span>https://www.metoffice.gov.uk/hadobs/hadsst4/data/netcdf/HadSST.4.0.1.0_median.nc
<span class="o">!</span>mv<span class="w"> </span>HadSST.4.0.1.0_median.nc<span class="w"> </span>./data
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--2024-07-22 09:29:37--  https://www.metoffice.gov.uk/hadobs/hadsst4/data/netcdf/HadSST.4.0.1.0_median.nc
Resolving www.metoffice.gov.uk (www.metoffice.gov.uk)... 23.42.200.119
Connecting to www.metoffice.gov.uk (www.metoffice.gov.uk)|23.42.200.119|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 8910040 (8.5M) [application/x-netcdf]
Saving to: ‘HadSST.4.0.1.0_median.nc’

HadSST.4.0.1.0_medi 100%[===================&gt;]   8.50M  5.14MB/s    in 1.7s    

2024-07-22 09:29:39 (5.14 MB/s) - ‘HadSST.4.0.1.0_median.nc’ saved [8910040/8910040]
</pre></div>
</div>
</div>
</div>
<p>Next we load it via the excellent <code class="docutils literal notranslate"><span class="pre">xarray</span></code> package.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="s1">&#39;./data/HadSST.4.0.1.0_median.nc&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;xarray.Dataset&gt; Size: 22MB
Dimensions:         (time: 2093, latitude: 36, longitude: 72, bnds: 2)
Coordinates:
  * time            (time) datetime64[ns] 17kB 1850-01-16T12:00:00 ... 2024-0...
  * latitude        (latitude) float64 288B -87.5 -82.5 -77.5 ... 77.5 82.5 87.5
  * longitude       (longitude) float64 576B -177.5 -172.5 ... 172.5 177.5
Dimensions without coordinates: bnds
Data variables:
    tos             (time, latitude, longitude) float32 22MB ...
    time_bnds       (time, bnds) datetime64[ns] 33kB ...
    latitude_bnds   (latitude, bnds) float64 576B ...
    longitude_bnds  (longitude, bnds) float64 1kB ...
Attributes:
    comment:      
    history:      Converted to netcdf today
    institution:  Met Office
    reference:    Kennedy et al. (2019), https://www.metoffice.gov.uk/hadobs/...
    source:       surface observation
    title:        Ensemble-median sea-surface temperature anomalies from the ...
    version:      HadSST.4.0.1.0
    Conventions:  CF-1.7
</pre></div>
</div>
</div>
</div>
<p>As an example, let’s only consider the Northern Hemisphere Pacific Ocean. For practicality, let’s first adjust the coordinate system so that longitude is expressed from 0 to 360 degrees instead of 180W to 180E:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_rolled</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span><span class="n">longitude</span><span class="o">=</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">longitude</span> <span class="o">%</span> <span class="mi">360</span><span class="p">))</span><span class="o">.</span><span class="n">sortby</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">longitude</span><span class="p">)</span>
<span class="n">ds_rolled</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt; Size: 22MB
Dimensions:         (time: 2093, latitude: 36, longitude: 72, bnds: 2)
Coordinates:
  * time            (time) datetime64[ns] 17kB 1850-01-16T12:00:00 ... 2024-0...
  * latitude        (latitude) float64 288B -87.5 -82.5 -77.5 ... 77.5 82.5 87.5
  * longitude       (longitude) float64 576B 2.5 7.5 12.5 ... 347.5 352.5 357.5
Dimensions without coordinates: bnds
Data variables:
    tos             (time, latitude, longitude) float32 22MB ...
    time_bnds       (time, bnds) datetime64[ns] 33kB ...
    latitude_bnds   (latitude, bnds) float64 576B ...
    longitude_bnds  (longitude, bnds) float64 1kB ...
Attributes:
    comment:      
    history:      Converted to netcdf today
    institution:  Met Office
    reference:    Kennedy et al. (2019), https://www.metoffice.gov.uk/hadobs/...
    source:       surface observation
    title:        Ensemble-median sea-surface temperature anomalies from the ...
    version:      HadSST.4.0.1.0
    Conventions:  CF-1.7</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-36aaf8b7-12d5-4d48-bd3c-b892986ed697' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-36aaf8b7-12d5-4d48-bd3c-b892986ed697' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>time</span>: 2093</li><li><span class='xr-has-index'>latitude</span>: 36</li><li><span class='xr-has-index'>longitude</span>: 72</li><li><span>bnds</span>: 2</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-366b9fbc-c022-4222-b46e-04774934466b' class='xr-section-summary-in' type='checkbox'  checked><label for='section-366b9fbc-c022-4222-b46e-04774934466b' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>1850-01-16T12:00:00 ... 2024-05-...</div><input id='attrs-c47c9743-5515-4f32-a6bc-57aa3a4ae93e' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-c47c9743-5515-4f32-a6bc-57aa3a4ae93e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-fdbcbd01-04db-4557-b889-60e56015c8f4' class='xr-var-data-in' type='checkbox'><label for='data-fdbcbd01-04db-4557-b889-60e56015c8f4' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>axis :</span></dt><dd>T</dd><dt><span>bounds :</span></dt><dd>time_bnds</dd><dt><span>standard_name :</span></dt><dd>time</dd><dt><span>long_name :</span></dt><dd>time</dd></dl></div><div class='xr-var-data'><pre>array([&#x27;1850-01-16T12:00:00.000000000&#x27;, &#x27;1850-02-15T00:00:00.000000000&#x27;,
       &#x27;1850-03-16T12:00:00.000000000&#x27;, ..., &#x27;2024-03-16T12:00:00.000000000&#x27;,
       &#x27;2024-04-16T00:00:00.000000000&#x27;, &#x27;2024-05-16T12:00:00.000000000&#x27;],
      dtype=&#x27;datetime64[ns]&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>latitude</span></div><div class='xr-var-dims'>(latitude)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>-87.5 -82.5 -77.5 ... 82.5 87.5</div><input id='attrs-ab9d90d2-5bd8-45ea-b88e-5276fec6c041' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-ab9d90d2-5bd8-45ea-b88e-5276fec6c041' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-95f282cd-a2d6-4b62-96e1-d30961845182' class='xr-var-data-in' type='checkbox'><label for='data-95f282cd-a2d6-4b62-96e1-d30961845182' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>axis :</span></dt><dd>Y</dd><dt><span>bounds :</span></dt><dd>latitude_bnds</dd><dt><span>units :</span></dt><dd>degrees_north</dd><dt><span>standard_name :</span></dt><dd>latitude</dd><dt><span>long_name :</span></dt><dd>latitude</dd></dl></div><div class='xr-var-data'><pre>array([-87.5, -82.5, -77.5, -72.5, -67.5, -62.5, -57.5, -52.5, -47.5, -42.5,
       -37.5, -32.5, -27.5, -22.5, -17.5, -12.5,  -7.5,  -2.5,   2.5,   7.5,
        12.5,  17.5,  22.5,  27.5,  32.5,  37.5,  42.5,  47.5,  52.5,  57.5,
        62.5,  67.5,  72.5,  77.5,  82.5,  87.5])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>longitude</span></div><div class='xr-var-dims'>(longitude)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>2.5 7.5 12.5 ... 347.5 352.5 357.5</div><input id='attrs-3e951b4b-f62d-44e5-8a80-c8c38093dde6' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-3e951b4b-f62d-44e5-8a80-c8c38093dde6' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-9365b413-05d9-4f55-bf2f-ad5ac4e4c5f4' class='xr-var-data-in' type='checkbox'><label for='data-9365b413-05d9-4f55-bf2f-ad5ac4e4c5f4' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([  2.5,   7.5,  12.5,  17.5,  22.5,  27.5,  32.5,  37.5,  42.5,  47.5,
        52.5,  57.5,  62.5,  67.5,  72.5,  77.5,  82.5,  87.5,  92.5,  97.5,
       102.5, 107.5, 112.5, 117.5, 122.5, 127.5, 132.5, 137.5, 142.5, 147.5,
       152.5, 157.5, 162.5, 167.5, 172.5, 177.5, 182.5, 187.5, 192.5, 197.5,
       202.5, 207.5, 212.5, 217.5, 222.5, 227.5, 232.5, 237.5, 242.5, 247.5,
       252.5, 257.5, 262.5, 267.5, 272.5, 277.5, 282.5, 287.5, 292.5, 297.5,
       302.5, 307.5, 312.5, 317.5, 322.5, 327.5, 332.5, 337.5, 342.5, 347.5,
       352.5, 357.5])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-8c882301-87dd-45f3-a1d2-80e3599976f6' class='xr-section-summary-in' type='checkbox'  checked><label for='section-8c882301-87dd-45f3-a1d2-80e3599976f6' class='xr-section-summary' >Data variables: <span>(4)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>tos</span></div><div class='xr-var-dims'>(time, latitude, longitude)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-8fc53edb-c1d0-4fce-b72a-c29c02542278' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-8fc53edb-c1d0-4fce-b72a-c29c02542278' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-b4c8ca46-453d-41b1-bf87-00b6b210c1d0' class='xr-var-data-in' type='checkbox'><label for='data-b4c8ca46-453d-41b1-bf87-00b6b210c1d0' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>standard_name :</span></dt><dd>sea_water_temperature_anomaly</dd><dt><span>long_name :</span></dt><dd>Sea water temperature anomaly at a depth of 20cm</dd><dt><span>units :</span></dt><dd>K</dd><dt><span>cell_methods :</span></dt><dd>area: mean (interval: 5.0 degrees_north 5.0 degrees_east) time: mean (interval: 1 month)</dd></dl></div><div class='xr-var-data'><pre>[5425056 values with dtype=float32]</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>time_bnds</span></div><div class='xr-var-dims'>(time, bnds)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-6cd40126-83d7-4782-a050-28fcb98a2ad6' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-6cd40126-83d7-4782-a050-28fcb98a2ad6' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-88a952f5-12eb-4f96-a365-04053a166531' class='xr-var-data-in' type='checkbox'><label for='data-88a952f5-12eb-4f96-a365-04053a166531' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>[4186 values with dtype=datetime64[ns]]</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>latitude_bnds</span></div><div class='xr-var-dims'>(latitude, bnds)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-2d5d0787-01f4-4643-afb0-79283fd7cf23' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-2d5d0787-01f4-4643-afb0-79283fd7cf23' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-68f6f596-c0e6-4ddb-ba9e-6760cfb37ab7' class='xr-var-data-in' type='checkbox'><label for='data-68f6f596-c0e6-4ddb-ba9e-6760cfb37ab7' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>[72 values with dtype=float64]</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>longitude_bnds</span></div><div class='xr-var-dims'>(longitude, bnds)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-288ba3c0-81b3-4873-bec5-cb006ec82565' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-288ba3c0-81b3-4873-bec5-cb006ec82565' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-e95b2593-64b7-43d2-a3e9-715c37299837' class='xr-var-data-in' type='checkbox'><label for='data-e95b2593-64b7-43d2-a3e9-715c37299837' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>[144 values with dtype=float64]</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-02a215e7-5c9f-43d6-a655-0ea784a29b4f' class='xr-section-summary-in' type='checkbox'  ><label for='section-02a215e7-5c9f-43d6-a655-0ea784a29b4f' class='xr-section-summary' >Indexes: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>time</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-02fff6b8-0111-4978-a3bf-2c8cfb08a371' class='xr-index-data-in' type='checkbox'/><label for='index-02fff6b8-0111-4978-a3bf-2c8cfb08a371' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(DatetimeIndex([&#x27;1850-01-16 12:00:00&#x27;, &#x27;1850-02-15 00:00:00&#x27;,
               &#x27;1850-03-16 12:00:00&#x27;, &#x27;1850-04-16 00:00:00&#x27;,
               &#x27;1850-05-16 12:00:00&#x27;, &#x27;1850-06-16 00:00:00&#x27;,
               &#x27;1850-07-16 12:00:00&#x27;, &#x27;1850-08-16 12:00:00&#x27;,
               &#x27;1850-09-16 00:00:00&#x27;, &#x27;1850-10-16 12:00:00&#x27;,
               ...
               &#x27;2023-08-16 12:00:00&#x27;, &#x27;2023-09-16 00:00:00&#x27;,
               &#x27;2023-10-16 12:00:00&#x27;, &#x27;2023-11-16 00:00:00&#x27;,
               &#x27;2023-12-16 12:00:00&#x27;, &#x27;2024-01-16 12:00:00&#x27;,
               &#x27;2024-02-15 12:00:00&#x27;, &#x27;2024-03-16 12:00:00&#x27;,
               &#x27;2024-04-16 00:00:00&#x27;, &#x27;2024-05-16 12:00:00&#x27;],
              dtype=&#x27;datetime64[ns]&#x27;, name=&#x27;time&#x27;, length=2093, freq=None))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>latitude</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-9ab0feb6-e2a5-4b5b-ac0a-b1336f93b4d8' class='xr-index-data-in' type='checkbox'/><label for='index-9ab0feb6-e2a5-4b5b-ac0a-b1336f93b4d8' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([-87.5, -82.5, -77.5, -72.5, -67.5, -62.5, -57.5, -52.5, -47.5, -42.5,
       -37.5, -32.5, -27.5, -22.5, -17.5, -12.5,  -7.5,  -2.5,   2.5,   7.5,
        12.5,  17.5,  22.5,  27.5,  32.5,  37.5,  42.5,  47.5,  52.5,  57.5,
        62.5,  67.5,  72.5,  77.5,  82.5,  87.5],
      dtype=&#x27;float64&#x27;, name=&#x27;latitude&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>longitude</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-21f8a559-3646-41b5-848b-163a094a2a4e' class='xr-index-data-in' type='checkbox'/><label for='index-21f8a559-3646-41b5-848b-163a094a2a4e' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([  2.5,   7.5,  12.5,  17.5,  22.5,  27.5,  32.5,  37.5,  42.5,  47.5,
        52.5,  57.5,  62.5,  67.5,  72.5,  77.5,  82.5,  87.5,  92.5,  97.5,
       102.5, 107.5, 112.5, 117.5, 122.5, 127.5, 132.5, 137.5, 142.5, 147.5,
       152.5, 157.5, 162.5, 167.5, 172.5, 177.5, 182.5, 187.5, 192.5, 197.5,
       202.5, 207.5, 212.5, 217.5, 222.5, 227.5, 232.5, 237.5, 242.5, 247.5,
       252.5, 257.5, 262.5, 267.5, 272.5, 277.5, 282.5, 287.5, 292.5, 297.5,
       302.5, 307.5, 312.5, 317.5, 322.5, 327.5, 332.5, 337.5, 342.5, 347.5,
       352.5, 357.5],
      dtype=&#x27;float64&#x27;, name=&#x27;longitude&#x27;))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-a3522482-50f0-4c1a-9a3c-5ec7e2f5b458' class='xr-section-summary-in' type='checkbox'  checked><label for='section-a3522482-50f0-4c1a-9a3c-5ec7e2f5b458' class='xr-section-summary' >Attributes: <span>(8)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>comment :</span></dt><dd></dd><dt><span>history :</span></dt><dd>Converted to netcdf today</dd><dt><span>institution :</span></dt><dd>Met Office</dd><dt><span>reference :</span></dt><dd>Kennedy et al. (2019), https://www.metoffice.gov.uk/hadobs/hadsst4</dd><dt><span>source :</span></dt><dd>surface observation</dd><dt><span>title :</span></dt><dd>Ensemble-median sea-surface temperature anomalies from the HadSST.4.0.1.0 data set</dd><dt><span>version :</span></dt><dd>HadSST.4.0.1.0</dd><dt><span>Conventions :</span></dt><dd>CF-1.7</dd></dl></div></li></ul></div></div></div></div>
</div>
<p>Now let’s select the needed data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_sel</span> <span class="o">=</span> <span class="n">ds_rolled</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">longitude</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span><span class="mi">280</span><span class="p">),</span><span class="n">latitude</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">90</span><span class="p">))</span>
<span class="n">ds_sel</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt; Size: 5MB
Dimensions:         (time: 2093, latitude: 18, longitude: 32, bnds: 2)
Coordinates:
  * time            (time) datetime64[ns] 17kB 1850-01-16T12:00:00 ... 2024-0...
  * latitude        (latitude) float64 144B 2.5 7.5 12.5 17.5 ... 77.5 82.5 87.5
  * longitude       (longitude) float64 256B 122.5 127.5 132.5 ... 272.5 277.5
Dimensions without coordinates: bnds
Data variables:
    tos             (time, latitude, longitude) float32 5MB ...
    time_bnds       (time, bnds) datetime64[ns] 33kB ...
    latitude_bnds   (latitude, bnds) float64 288B ...
    longitude_bnds  (longitude, bnds) float64 512B ...
Attributes:
    comment:      
    history:      Converted to netcdf today
    institution:  Met Office
    reference:    Kennedy et al. (2019), https://www.metoffice.gov.uk/hadobs/...
    source:       surface observation
    title:        Ensemble-median sea-surface temperature anomalies from the ...
    version:      HadSST.4.0.1.0
    Conventions:  CF-1.7</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-e89a80e5-da5c-4c12-b0cc-e23b1caf9bd1' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-e89a80e5-da5c-4c12-b0cc-e23b1caf9bd1' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>time</span>: 2093</li><li><span class='xr-has-index'>latitude</span>: 18</li><li><span class='xr-has-index'>longitude</span>: 32</li><li><span>bnds</span>: 2</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-a64e4dd7-931f-4923-b08e-206dc8310974' class='xr-section-summary-in' type='checkbox'  checked><label for='section-a64e4dd7-931f-4923-b08e-206dc8310974' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>1850-01-16T12:00:00 ... 2024-05-...</div><input id='attrs-3d937677-4e4f-4d26-9766-2c0a08222de2' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-3d937677-4e4f-4d26-9766-2c0a08222de2' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-1c0640fd-6456-45b1-ab63-20189d8a1bc7' class='xr-var-data-in' type='checkbox'><label for='data-1c0640fd-6456-45b1-ab63-20189d8a1bc7' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>axis :</span></dt><dd>T</dd><dt><span>bounds :</span></dt><dd>time_bnds</dd><dt><span>standard_name :</span></dt><dd>time</dd><dt><span>long_name :</span></dt><dd>time</dd></dl></div><div class='xr-var-data'><pre>array([&#x27;1850-01-16T12:00:00.000000000&#x27;, &#x27;1850-02-15T00:00:00.000000000&#x27;,
       &#x27;1850-03-16T12:00:00.000000000&#x27;, ..., &#x27;2024-03-16T12:00:00.000000000&#x27;,
       &#x27;2024-04-16T00:00:00.000000000&#x27;, &#x27;2024-05-16T12:00:00.000000000&#x27;],
      dtype=&#x27;datetime64[ns]&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>latitude</span></div><div class='xr-var-dims'>(latitude)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>2.5 7.5 12.5 ... 77.5 82.5 87.5</div><input id='attrs-62587374-03ea-4015-ae2d-aa1978552b4f' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-62587374-03ea-4015-ae2d-aa1978552b4f' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-62697969-a696-4619-aadc-2f4e291f99ba' class='xr-var-data-in' type='checkbox'><label for='data-62697969-a696-4619-aadc-2f4e291f99ba' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>axis :</span></dt><dd>Y</dd><dt><span>bounds :</span></dt><dd>latitude_bnds</dd><dt><span>units :</span></dt><dd>degrees_north</dd><dt><span>standard_name :</span></dt><dd>latitude</dd><dt><span>long_name :</span></dt><dd>latitude</dd></dl></div><div class='xr-var-data'><pre>array([ 2.5,  7.5, 12.5, 17.5, 22.5, 27.5, 32.5, 37.5, 42.5, 47.5, 52.5, 57.5,
       62.5, 67.5, 72.5, 77.5, 82.5, 87.5])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>longitude</span></div><div class='xr-var-dims'>(longitude)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>122.5 127.5 132.5 ... 272.5 277.5</div><input id='attrs-d97c68b3-1c47-498d-b424-0a3cbc9eeec8' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-d97c68b3-1c47-498d-b424-0a3cbc9eeec8' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-fb549507-0f2c-4053-a34e-1076d4e285d3' class='xr-var-data-in' type='checkbox'><label for='data-fb549507-0f2c-4053-a34e-1076d4e285d3' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([122.5, 127.5, 132.5, 137.5, 142.5, 147.5, 152.5, 157.5, 162.5, 167.5,
       172.5, 177.5, 182.5, 187.5, 192.5, 197.5, 202.5, 207.5, 212.5, 217.5,
       222.5, 227.5, 232.5, 237.5, 242.5, 247.5, 252.5, 257.5, 262.5, 267.5,
       272.5, 277.5])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-99a136a5-e27e-42be-bef0-145b8466e4d5' class='xr-section-summary-in' type='checkbox'  checked><label for='section-99a136a5-e27e-42be-bef0-145b8466e4d5' class='xr-section-summary' >Data variables: <span>(4)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>tos</span></div><div class='xr-var-dims'>(time, latitude, longitude)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-b685e2e4-143c-428f-815b-c98685537843' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-b685e2e4-143c-428f-815b-c98685537843' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-966dc0fd-2394-4776-86e7-92a70f3e438b' class='xr-var-data-in' type='checkbox'><label for='data-966dc0fd-2394-4776-86e7-92a70f3e438b' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>standard_name :</span></dt><dd>sea_water_temperature_anomaly</dd><dt><span>long_name :</span></dt><dd>Sea water temperature anomaly at a depth of 20cm</dd><dt><span>units :</span></dt><dd>K</dd><dt><span>cell_methods :</span></dt><dd>area: mean (interval: 5.0 degrees_north 5.0 degrees_east) time: mean (interval: 1 month)</dd></dl></div><div class='xr-var-data'><pre>[1205568 values with dtype=float32]</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>time_bnds</span></div><div class='xr-var-dims'>(time, bnds)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-33e0fda2-3dab-41f6-9e20-3bb7713ef6ae' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-33e0fda2-3dab-41f6-9e20-3bb7713ef6ae' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-df191644-d319-4473-83f4-7d53592561d4' class='xr-var-data-in' type='checkbox'><label for='data-df191644-d319-4473-83f4-7d53592561d4' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>[4186 values with dtype=datetime64[ns]]</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>latitude_bnds</span></div><div class='xr-var-dims'>(latitude, bnds)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-9cac56f3-d0e0-49aa-a195-1818dbe15f61' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-9cac56f3-d0e0-49aa-a195-1818dbe15f61' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-a663eb69-263f-493e-b9f3-c3032c80a905' class='xr-var-data-in' type='checkbox'><label for='data-a663eb69-263f-493e-b9f3-c3032c80a905' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>[36 values with dtype=float64]</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>longitude_bnds</span></div><div class='xr-var-dims'>(longitude, bnds)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-c67fe105-be09-4332-aaff-918857540c04' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-c67fe105-be09-4332-aaff-918857540c04' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-837a52d6-736a-4041-a9ae-600f134ebc95' class='xr-var-data-in' type='checkbox'><label for='data-837a52d6-736a-4041-a9ae-600f134ebc95' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>[64 values with dtype=float64]</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-0d4fe79e-d312-44fd-a130-6d5193563ec5' class='xr-section-summary-in' type='checkbox'  ><label for='section-0d4fe79e-d312-44fd-a130-6d5193563ec5' class='xr-section-summary' >Indexes: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>time</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-175ac39c-1891-4694-8cf1-1e8eae4d843b' class='xr-index-data-in' type='checkbox'/><label for='index-175ac39c-1891-4694-8cf1-1e8eae4d843b' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(DatetimeIndex([&#x27;1850-01-16 12:00:00&#x27;, &#x27;1850-02-15 00:00:00&#x27;,
               &#x27;1850-03-16 12:00:00&#x27;, &#x27;1850-04-16 00:00:00&#x27;,
               &#x27;1850-05-16 12:00:00&#x27;, &#x27;1850-06-16 00:00:00&#x27;,
               &#x27;1850-07-16 12:00:00&#x27;, &#x27;1850-08-16 12:00:00&#x27;,
               &#x27;1850-09-16 00:00:00&#x27;, &#x27;1850-10-16 12:00:00&#x27;,
               ...
               &#x27;2023-08-16 12:00:00&#x27;, &#x27;2023-09-16 00:00:00&#x27;,
               &#x27;2023-10-16 12:00:00&#x27;, &#x27;2023-11-16 00:00:00&#x27;,
               &#x27;2023-12-16 12:00:00&#x27;, &#x27;2024-01-16 12:00:00&#x27;,
               &#x27;2024-02-15 12:00:00&#x27;, &#x27;2024-03-16 12:00:00&#x27;,
               &#x27;2024-04-16 00:00:00&#x27;, &#x27;2024-05-16 12:00:00&#x27;],
              dtype=&#x27;datetime64[ns]&#x27;, name=&#x27;time&#x27;, length=2093, freq=None))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>latitude</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-749c8381-eee2-4f0d-bcc0-5db6696880e4' class='xr-index-data-in' type='checkbox'/><label for='index-749c8381-eee2-4f0d-bcc0-5db6696880e4' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([ 2.5,  7.5, 12.5, 17.5, 22.5, 27.5, 32.5, 37.5, 42.5, 47.5, 52.5, 57.5,
       62.5, 67.5, 72.5, 77.5, 82.5, 87.5],
      dtype=&#x27;float64&#x27;, name=&#x27;latitude&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>longitude</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-07598363-36b9-4b95-ac57-40a0c637e311' class='xr-index-data-in' type='checkbox'/><label for='index-07598363-36b9-4b95-ac57-40a0c637e311' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([122.5, 127.5, 132.5, 137.5, 142.5, 147.5, 152.5, 157.5, 162.5, 167.5,
       172.5, 177.5, 182.5, 187.5, 192.5, 197.5, 202.5, 207.5, 212.5, 217.5,
       222.5, 227.5, 232.5, 237.5, 242.5, 247.5, 252.5, 257.5, 262.5, 267.5,
       272.5, 277.5],
      dtype=&#x27;float64&#x27;, name=&#x27;longitude&#x27;))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-7f3e7480-52a4-4570-93df-8d40f9a3dcae' class='xr-section-summary-in' type='checkbox'  checked><label for='section-7f3e7480-52a4-4570-93df-8d40f9a3dcae' class='xr-section-summary' >Attributes: <span>(8)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>comment :</span></dt><dd></dd><dt><span>history :</span></dt><dd>Converted to netcdf today</dd><dt><span>institution :</span></dt><dd>Met Office</dd><dt><span>reference :</span></dt><dd>Kennedy et al. (2019), https://www.metoffice.gov.uk/hadobs/hadsst4</dd><dt><span>source :</span></dt><dd>surface observation</dd><dt><span>title :</span></dt><dd>Ensemble-median sea-surface temperature anomalies from the HadSST.4.0.1.0 data set</dd><dt><span>version :</span></dt><dd>HadSST.4.0.1.0</dd><dt><span>Conventions :</span></dt><dd>CF-1.7</dd></dl></div></li></ul></div></div></div></div>
</div>
</section>
</section>
<section id="pitfall-1-persistence">
<h2>Pitfall #1: Persistence<a class="headerlink" href="#pitfall-1-persistence" title="Link to this heading">#</a></h2>
<p>Persistence is the tendency of many geophysical timeseries (particularly in paleoclimatology) to show some kind of memory: consecutive observations tend to resemble each other, resulting in timeseries that have fairly broad trends and low-frequency fluctuations, and comparatively little high-frequency fluctuations.  This has an important consequence: the standard assumption of independence, which undergirds much of frequentist statistics, is violated in this case. In a timeseries with <span class="math notranslate nohighlight">\(n\)</span> fully independent observations (e.g. white noise), the degrees of freedom for the variance are <span class="math notranslate nohighlight">\(DOF = n -1\)</span>  But if memory is present, this number can be drastically reduced.</p>
<p>Let us look at a random location and build some intuition. First, we need to compute monthly anomalies and annualize them. <code class="docutils literal notranslate"><span class="pre">xarray</span></code> makes that easy (four lines of code plus another line for plotting), so let’s look at the result:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">st</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;tos&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">latitude</span><span class="o">=</span><span class="mf">32.5</span><span class="p">,</span> <span class="n">longitude</span> <span class="o">=</span> <span class="mf">142.5</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>  <span class="c1"># 32.5N 142.5W near Kuroshio Extension</span>
<span class="n">climatology</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;time.month&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
<span class="n">anomalies</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;time.month&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="n">climatology</span>
<span class="n">st_annual</span> <span class="o">=</span> <span class="n">anomalies</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;time.year&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
<span class="n">st_annual</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x326513150&gt;]
</pre></div>
</div>
<img alt="../_images/4a2e27f44c99487339f4e30e01c57347a434921a8f454eb429bc1a1d8d9e938f.png" src="../_images/4a2e27f44c99487339f4e30e01c57347a434921a8f454eb429bc1a1d8d9e938f.png" />
</div>
</div>
<p>Notice the coverage gaps in the 1860s. This, and the fact that the Crystal Cave chronology is not uniformly spaced, would ordinarily make it challenging to compare the two series, requiring some form of interpolation or binning. Pyleoclim does all this under the hood, provided the temperature data are turned into a <em>Series</em> object, which is a quick operation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stts</span> <span class="o">=</span> <span class="n">pyleo</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">st_annual</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                    <span class="n">time_unit</span> <span class="o">=</span><span class="s1">&#39;year CE&#39;</span><span class="p">,</span> 
                    <span class="n">value</span><span class="o">=</span><span class="n">st_annual</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s1">&#39;SST&#39;</span><span class="p">,</span>
                    <span class="n">value_unit</span> <span class="o">=</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;HadCRUT4, 32.5N, 142.5E&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>NaNs have been detected and dropped.
Time axis values sorted in ascending order
</pre></div>
</div>
</div>
</div>
<p>Now we can compute correlations with the Crystal Cave record.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr_res</span> <span class="o">=</span> <span class="n">stts</span><span class="o">.</span><span class="n">correlation</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span> <span class="n">seed</span> <span class="o">=</span> <span class="mi">2333</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">corr_res</span><span class="o">.</span><span class="n">r</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2874.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.3235963792817965
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<p>Quite a few things happened here. First, <code class="docutils literal notranslate"><span class="pre">pyleoclim</span></code> was smart enough to figure out a common timespan between the two records, and used linear interpolation to align the two timeseries on a common axis. Most users will be grateful not to have to do this explcitly, but the process can be customized (see <a class="reference internal" href="#alignment"><span class="xref myst">Timeseries alignment</span></a>).</p>
<p>The correlation is <span class="math notranslate nohighlight">\(r=0.324\)</span>, and the natural question is: “Is this number significant (i.e. unusual)?” The standard way to assess this is with <span class="math notranslate nohighlight">\(t\)</span>-test using the test statistic: $<span class="math notranslate nohighlight">\(T = \frac{r \sqrt{n-2}}{\sqrt{1-r^2}}\)</span><span class="math notranslate nohighlight">\( (see e.g. Wilks, 2011)  If we plug in the values of \)</span>r<span class="math notranslate nohighlight">\( and \)</span>n$, we get:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ccs</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">slice</span><span class="p">([</span><span class="mi">1854</span><span class="p">,</span><span class="mi">2020</span><span class="p">])</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ccs</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
<span class="n">nu</span> <span class="o">=</span> <span class="n">n</span><span class="o">-</span><span class="mi">2</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">corr_res</span><span class="o">.</span><span class="n">r</span>
<span class="n">T</span>  <span class="o">=</span> <span class="n">r</span> <span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">nu</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The test statistic is &quot;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">T</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The test statistic is 3.586899835725328
</pre></div>
</div>
</div>
</div>
<p>Under standard assumptions (the data are independent and identically distributed), <span class="math notranslate nohighlight">\(T\)</span> follows Student’s <span class="math notranslate nohighlight">\(t\)</span> distribution. If we make the same assumption and use the <span class="math notranslate nohighlight">\(t\)</span> distribution from SciPy, we can readily compute the p-value (i.e. the probability to observe a test statistic at least as large as this one, under the null distribution):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">t</span>
<span class="n">pval</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">t</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="n">nu</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The p-value is </span><span class="si">{:10.2e}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pval</span><span class="p">))</span> <span class="c1"># express in exponential notation</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The p-value is   2.50e-04
</pre></div>
</div>
</div>
</div>
<p>In other words, using the classic test for the significance of correlations “out of the box”, one would conclude that SST at 42N, 164E shares so much similarity with the Crystal Cave record that there are about 2 chances in 10,000 that this could have happened randomly. In other words, it looks <em>rather</em> significant.</p>
<p>However, this test (which is the one that most computing packages, including Excel, implement by default) is not appropriate here, as the theory only applies to data that are independent and indentically distributed (“IID”). Independence means that consecutive observations have no predictive power over each other, which is true neither of the Crystal Cave nor the instrumental target. That is to say: because temperature in one year tends to resemble temperature in the previous or following year (same for <span class="math notranslate nohighlight">\(\delta^{18}O\)</span>), the data are anything but independent. We will quantify this dependence, and its consequences, below.</p>
<p>The full result of the Pyleoclim <code class="docutils literal notranslate"><span class="pre">correlation()</span></code> command looks like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">corr_res</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  correlation    p-value  signif. (α: 0.05)
-------------  ---------  -------------------
     0.323596       0.14  False
</pre></div>
</div>
</div>
</div>
<p>That is, the correlation value ships with an estimate of the p-value and a boolean flag (True/False) stating whether or not it is below the test level <span class="math notranslate nohighlight">\(\alpha\)</span>. However, the p-value here is estimated to be 14% (<code class="docutils literal notranslate"><span class="pre">'p':</span> <span class="pre">0.14</span></code>), and therefore the correlation is not deemed significant (<code class="docutils literal notranslate"><span class="pre">'signif':</span> <span class="pre">False</span></code>) at the 5% level (<code class="docutils literal notranslate"><span class="pre">'alpha':</span> <span class="pre">0.05</span></code>). How did <code class="docutils literal notranslate"><span class="pre">pyleoclim</span></code> arrive at such a different conclusion than the <span class="math notranslate nohighlight">\(2.5 \times 10^{-4}\)</span> seen just above?</p>
<section id="null-models">
<h3>Null Models<a class="headerlink" href="#null-models" title="Link to this heading">#</a></h3>
<p>There are in fact 3 ways to make this determination in Pyleoclim. While the standard null model for correlations in the statistical literature is the IID model, we have just seen that it is violated by the persistence of many timeseries, particularly the ones shown above.  The package does implements the classical T-test, but it is adjusted for the loss of degrees of freedom due to persistence as per Dawdy &amp; Matalas (1964):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr_ttest</span> <span class="o">=</span> <span class="n">stts</span><span class="o">.</span><span class="n">correlation</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="n">statistic</span><span class="o">=</span><span class="s1">&#39;pearsonr&#39;</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;ttest&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">corr_ttest</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  correlation    p-value  signif. (α: 0.05)
-------------  ---------  -------------------
     0.323596       0.16  False
</pre></div>
</div>
</div>
</div>
<p>As a result, the the p-value for the test is now 16%, far above the  <span class="math notranslate nohighlight">\(2.4 \times 10^{-4}\)</span> it would be under the IID assumption.</p>
<p>The next option compares the observed correlation to the distribution of correlations with (by default) 1000 randomly-generated autoregressive (AR(1)) timeseries with the same persistence parameters as the original series, as measured by the lag-1 autocorrelation. This model is parametric and it preserves the persistence properties of each series:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr_isopersist</span> <span class="o">=</span> <span class="n">stts</span><span class="o">.</span><span class="n">correlation</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="n">statistic</span><span class="o">=</span><span class="s1">&#39;pearsonr&#39;</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;ar1sim&#39;</span><span class="p">,</span> <span class="n">seed</span> <span class="o">=</span> <span class="mi">2333</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">corr_isopersist</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2891.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  correlation    p-value  signif. (α: 0.05)
-------------  ---------  -------------------
     0.323596       0.11  False
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<p>Because this is a simulation-based method, the result will depent on the number of simulations, <code class="docutils literal notranslate"><span class="pre">nsim</span></code>.  Upping <code class="docutils literal notranslate"><span class="pre">nsim</span></code> ensures more consistent results, though in this case the result does not change:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr_isopersist</span> <span class="o">=</span> <span class="n">stts</span><span class="o">.</span><span class="n">correlation</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="n">statistic</span><span class="o">=</span><span class="s1">&#39;pearsonr&#39;</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;ar1sim&#39;</span><span class="p">,</span> <span class="n">seed</span> <span class="o">=</span> <span class="mi">2333</span><span class="p">,</span> <span class="n">number</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">corr_isopersist</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating association on surrogate pairs: 100%|█| 2000/2000 [00:00&lt;00:00, 2903.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  correlation    p-value  signif. (α: 0.05)
-------------  ---------  -------------------
     0.323596       0.12  False
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<p>We see that the p-value changes subtly between these two cases, but not enough to change the result (the correlation is non significant either way). However, to ensure that these sampling issues won’t affect the reproducibility of the results, we specify a <a class="reference external" href="https://en.wikipedia.org/wiki/Random_seed">random seed</a>. Note that the difference between “significant” and “not significant” p-values is not itself statistically significant (Gelman &amp; Stern, 2006).</p>
<p>The last null model method is <code class="docutils literal notranslate"><span class="pre">phaseran</span></code>, which phase-randomizes the original signals, thereby preserving the spectrum of each series but scrambling phase relations between the signals. This (non-paramettric) method was first proposed by Ebisuzaki (1997), and is called <em>phaseran</em> because it leaves the spectrum (and therefore the autocorrelation function) intact. Since, this is also a simulation method, one can also play with the number of simulations, as done here:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr_isospec</span> <span class="o">=</span> <span class="n">stts</span><span class="o">.</span><span class="n">correlation</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="n">statistic</span><span class="o">=</span><span class="s1">&#39;pearsonr&#39;</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;phaseran&#39;</span><span class="p">,</span> <span class="n">seed</span> <span class="o">=</span> <span class="mi">4343</span><span class="p">,</span> <span class="n">number</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">corr_isospec</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating association on surrogate pairs: 100%|█| 2000/2000 [00:00&lt;00:00, 2830.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  correlation    p-value  signif. (α: 0.05)
-------------  ---------  -------------------
     0.323596       0.14  False
</pre></div>
</div>
</div>
</div>
<p>We see that this resulted is a modestly different p-value, but again one above 5%, which leads to rejection of the null.</p>
<p>In this case, the three methods concur that the correlation is insignificant, though we encourage users to play with these methods in case they obtain results close to the test-level, to discourage p-hacking temptations.</p>
</section>
<section id="timeseries-alignment">
<h3>Timeseries Alignment<a class="headerlink" href="#timeseries-alignment" title="Link to this heading">#</a></h3>
<p>As mentioned earlier, the SST and Crystal Cave series are on different time axes, and <code class="docutils literal notranslate"><span class="pre">Pyleoclim</span></code> automated the process of aligning them, doing so under the hood so users can focus on doing science. However, it is useful to understand what is happening and how it can be customized, in case this makes a difference to the analysis.  Like other <code class="docutils literal notranslate"><span class="pre">Pyleoclim</span></code> methods designed to compare timeseries,  <code class="docutils literal notranslate"><span class="pre">correlation()</span></code> relies on the <code class="docutils literal notranslate"><span class="pre">MultipleSeries.common_time()</span></code> method for alignment. The method implements three strategies for timeseries alignment:</p>
<ol class="arabic simple">
<li><p>interpolation</p></li>
<li><p>binning</p></li>
<li><p>Gaussian kernel smoothing</p></li>
</ol>
<p>To explore it, let us first create a <code class="docutils literal notranslate"><span class="pre">MultipleSeries</span></code> object gathering those two series:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ms</span> <span class="o">=</span> <span class="n">pyleo</span><span class="o">.</span><span class="n">MultipleSeries</span><span class="p">([</span><span class="n">cc</span><span class="p">,</span><span class="n">stts</span><span class="p">])</span>
<span class="n">ms</span><span class="o">.</span><span class="n">stackplot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 640x480 with 3 Axes&gt;,
 {0: &lt;Axes: ylabel=&#39;$\\delta^{18}O$ [‰]&#39;&gt;,
  1: &lt;Axes: ylabel=&#39;SST [C]&#39;&gt;,
  &#39;x_axis&#39;: &lt;Axes: xlabel=&#39;Time [year CE]&#39;&gt;})
</pre></div>
</div>
<img alt="../_images/4c301ecab1eddcf140ee4c1f4d9d2ba253f3229353843481c21e9820eb3586d5.png" src="../_images/4c301ecab1eddcf140ee4c1f4d9d2ba253f3229353843481c21e9820eb3586d5.png" />
</div>
</div>
<p>By default, <code class="docutils literal notranslate"><span class="pre">common_time()</span></code> will implement linear interpolation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">msi</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">common_time</span><span class="p">()</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">msi</span><span class="o">.</span><span class="n">stackplot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/0761174cfa9c217740f546080a0e97ab38506129233d61ab0ae4afcbcbda0290.png" src="../_images/0761174cfa9c217740f546080a0e97ab38506129233d61ab0ae4afcbcbda0290.png" />
</div>
</div>
<p>It is easy to verify that the two series are indeed on the same axis:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">msi</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">time</span> <span class="o">==</span> <span class="n">msi</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">time</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ True,  True,  True,  True,  True,  True,  True,  True,  True,
        True,  True,  True,  True,  True,  True,  True,  True,  True,
        True,  True,  True,  True,  True,  True,  True,  True,  True,
        True,  True,  True,  True,  True,  True,  True,  True,  True,
        True,  True,  True,  True,  True,  True,  True,  True,  True,
        True,  True,  True,  True,  True,  True,  True,  True,  True,
        True,  True,  True,  True,  True,  True,  True,  True,  True,
        True,  True,  True,  True,  True,  True,  True,  True,  True,
        True,  True,  True,  True,  True,  True,  True,  True,  True,
        True,  True,  True,  True,  True,  True,  True,  True,  True,
        True,  True,  True,  True,  True,  True,  True,  True,  True,
        True,  True,  True,  True,  True,  True,  True,  True,  True,
        True,  True,  True,  True,  True,  True,  True,  True,  True,
        True,  True,  True,  True,  True,  True,  True,  True,  True,
        True,  True,  True,  True,  True,  True,  True,  True,  True,
        True,  True,  True,  True,  True,  True,  True,  True,  True,
        True,  True,  True])
</pre></div>
</div>
</div>
</div>
<p>To see how the interpolation changed the original series, we can superimpose the original series as dots on top of this stackplot:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">msi</span><span class="o">.</span><span class="n">stackplot</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fill_between_alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">cc</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">stts</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: ylabel=&#39;SST [C]&#39;&gt;
</pre></div>
</div>
<img alt="../_images/af5e6b8f4fc5749c3cc93020e0cadf535c39b8283761eef121df9ac1155b7fdd.png" src="../_images/af5e6b8f4fc5749c3cc93020e0cadf535c39b8283761eef121df9ac1155b7fdd.png" />
</div>
</div>
<p>We see that interpolation left the Crystal Cave record relatively unchanged, except near the end where resolution is very high. For the HadCRUT4 data, the effect is most noticeable in the 1870s, where there is a gap in data coverage. This could be customized: both the type of interpolation (e.g. linear, quadratic) and the grid step, are customizable (see the <a class="reference external" href="https://pyleoclim-util.readthedocs.io/en/latest/utils/introduction.html#pyleoclim.utils.tsutils.interp">documentation</a>.</p>
<p>As an example, we could use cubic spline interpoliation, which carries the well-known risk of overfitting, thereby creating unrealistic excursions away from observations:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">msi</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">common_time</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;interp&#39;</span><span class="p">,</span><span class="n">interp_type</span> <span class="o">=</span> <span class="s1">&#39;cubic&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">msi</span><span class="o">.</span><span class="n">stackplot</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fill_between_alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">cc</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">stts</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: ylabel=&#39;SST [C]&#39;&gt;
</pre></div>
</div>
<img alt="../_images/ffa6eabef6784998f8a96bd7719b6fee49fc2cfbc663be3ca6ee0fb5c9a80da2.png" src="../_images/ffa6eabef6784998f8a96bd7719b6fee49fc2cfbc663be3ca6ee0fb5c9a80da2.png" />
</div>
</div>
<p>Another option is <a class="reference external" href="https://pyleoclim-util.readthedocs.io/en/latest/utils/introduction.html#pyleoclim.utils.tsutils.bin">binning</a>, which tends to coarse-grain more, as it will default to the largest time spacing observed in either series to avoid empty bins:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">msb</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">common_time</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;bin&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">msb</span><span class="o">.</span><span class="n">stackplot</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fill_between_alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">cc</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">stts</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: ylabel=&#39;SST [C]&#39;&gt;
</pre></div>
</div>
<img alt="../_images/66af9e5720ef62fe405b363ad310974de1acd0d98a3edff1d262f44c9c9c6811.png" src="../_images/66af9e5720ef62fe405b363ad310974de1acd0d98a3edff1d262f44c9c9c6811.png" />
</div>
</div>
<p>Lastly, one may request a gaussian kernel (Rehfeld &amp; Kurths, 2014), which by default uses a bandwidth of 3:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">msg</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">common_time</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;gkernel&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">stackplot</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fill_between_alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">cc</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">stts</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: ylabel=&#39;SST [C]&#39;&gt;
</pre></div>
</div>
<img alt="../_images/074da34f5d352aae74a940218d82188f17f2a5ae90d9c64eea962422cdf414da.png" src="../_images/074da34f5d352aae74a940218d82188f17f2a5ae90d9c64eea962422cdf414da.png" />
</div>
</div>
<p>It is easy to change the bandwidth <span class="math notranslate nohighlight">\(h\)</span>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">msg</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">common_time</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;gkernel&#39;</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">stackplot</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fill_between_alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">cc</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">stts</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: ylabel=&#39;SST [C]&#39;&gt;
</pre></div>
</div>
<img alt="../_images/3cd7aeeb9d4e2cb88613582350bb0ddc190929dbb95442e2731364b0ca2264c3.png" src="../_images/3cd7aeeb9d4e2cb88613582350bb0ddc190929dbb95442e2731364b0ca2264c3.png" />
</div>
</div>
<p>The Gaussian kernel method is quite conservative, and typically uses the coarsest possible resolution.</p>
<p>At the level of correlations, users may specify how they wish to perform this time alignment via the <code class="docutils literal notranslate"><span class="pre">common_time_kwargs</span></code> dictionary, like so:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr_isospec</span> <span class="o">=</span> <span class="n">stts</span><span class="o">.</span><span class="n">correlation</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="n">statistic</span><span class="o">=</span><span class="s1">&#39;pearsonr&#39;</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;phaseran&#39;</span><span class="p">,</span> <span class="n">number</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span> 
                                <span class="n">common_time_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;method&#39;</span><span class="p">:</span><span class="s1">&#39;interp&#39;</span><span class="p">,</span><span class="s1">&#39;interp_type&#39;</span><span class="p">:</span><span class="s1">&#39;cubic&#39;</span><span class="p">},</span> <span class="n">seed</span> <span class="o">=</span> <span class="mi">4343</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">corr_isospec</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating association on surrogate pairs: 100%|█| 2000/2000 [00:00&lt;00:00, 2785.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  correlation    p-value  signif. (α: 0.05)
-------------  ---------  -------------------
     0.187768       0.36  False
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<p>We see that the type of interpolation was somewhat consequential here, lowering the original correlation quite a bit, but this does not change the result. If this low-level task turns out to affect the analysis, it is prudent to take a peak “under the hood” as we did here, and visualize how time series alignment affects the original series. In most instances, however, this should not greatly affect the outcome.</p>
<p>Note: in the case of the T-test, it would be sufficient to put the timeseries on the same time axis, but that this axis need not be evenly spaced. This is not implemented here.</p>
</section>
</section>
<section id="pitfall-2-multiple-hypothesis-testing">
<h2>Pitfall #2: Multiple Hypothesis Testing<a class="headerlink" href="#pitfall-2-multiple-hypothesis-testing" title="Link to this heading">#</a></h2>
<p>The previous section shows how to properly assess significance at a single location. The situation becomes more complex as one  conducts a similar test for an entire field. To see why, let us recursively carry out the same test as above at all grid points. For this, we need not only to loop over grid points, but also store the p-values for later analysis. To save time, we’ll use the <code class="docutils literal notranslate"><span class="pre">ttest</span></code> option for <code class="docutils literal notranslate"><span class="pre">correlation()</span></code>, knowing that it is rather approximate. Also, we need to exclude points that have too few observations. The loop below achieves that.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nlon</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ds_sel</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">])</span>
<span class="n">nlat</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ds_sel</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> 
<span class="n">pval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">nlon</span><span class="p">,</span><span class="n">nlat</span><span class="p">))</span> <span class="c1"># declare array to store pvalues</span>
<span class="n">corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">pval</span><span class="p">)</span> <span class="c1"># declare empty array of identical shape</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">slon</span><span class="p">,</span> <span class="n">slat</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[];</span>
<span class="k">for</span> <span class="n">ji</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nlon</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Computing correlations at &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ds_sel</span><span class="o">.</span><span class="n">longitude</span><span class="p">[</span><span class="n">ji</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nlat</span><span class="p">):</span>   
        <span class="n">st</span> <span class="o">=</span> <span class="n">ds_sel</span><span class="p">[</span><span class="s1">&#39;tos&#39;</span><span class="p">][:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ji</span><span class="p">]</span>
        <span class="n">climatology</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;time.month&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
        <span class="n">anomalies</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;time.month&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="n">climatology</span>
        <span class="n">st_annual</span> <span class="o">=</span> <span class="n">anomalies</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;time.year&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
        <span class="c1">#  test if at least 100 non-NaNs</span>
        <span class="n">noNaNs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">st_annual</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># number of valid years</span>
        <span class="n">sstvar</span> <span class="o">=</span> <span class="n">st_annual</span><span class="o">.</span><span class="n">var</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">noNaNs</span> <span class="o">&gt;=</span> <span class="mi">100</span> <span class="ow">and</span> <span class="n">sstvar</span> <span class="o">&gt;=</span> <span class="mf">0.01</span><span class="p">:</span>
            <span class="n">sttb</span> <span class="o">=</span> <span class="n">pyleo</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">st_annual</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                        <span class="n">time_unit</span> <span class="o">=</span><span class="s1">&#39;year CE&#39;</span><span class="p">,</span> 
                        <span class="n">value</span><span class="o">=</span><span class="n">st_annual</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                        <span class="n">value_unit</span> <span class="o">=</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">corr_res</span> <span class="o">=</span> <span class="n">sttb</span><span class="o">.</span><span class="n">correlation</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;ttest&#39;</span><span class="p">)</span>
            <span class="n">pval</span><span class="p">[</span><span class="n">ji</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">corr_res</span><span class="o">.</span><span class="n">p</span>
            <span class="n">corr</span><span class="p">[</span><span class="n">ji</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">corr_res</span><span class="o">.</span><span class="n">r</span>
            <span class="k">if</span> <span class="n">pval</span><span class="p">[</span><span class="n">ji</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">alpha</span><span class="p">:</span>
                <span class="n">slon</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ds_sel</span><span class="o">.</span><span class="n">longitude</span><span class="p">[</span><span class="n">ji</span><span class="p">])</span>
                <span class="n">slat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ds_sel</span><span class="o">.</span><span class="n">latitude</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>  
            <span class="n">pval</span><span class="p">[</span><span class="n">ji</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">;</span> <span class="n">corr</span><span class="p">[</span><span class="n">ji</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Computing correlations at 122.5E
Computing correlations at 127.5E
Computing correlations at 132.5E
Computing correlations at 137.5E
Computing correlations at 142.5E
Computing correlations at 147.5E
Computing correlations at 152.5E
Computing correlations at 157.5E
Computing correlations at 162.5E
Computing correlations at 167.5E
Computing correlations at 172.5E
Computing correlations at 177.5E
Computing correlations at 182.5E
Computing correlations at 187.5E
Computing correlations at 192.5E
Computing correlations at 197.5E
Computing correlations at 202.5E
Computing correlations at 207.5E
Computing correlations at 212.5E
Computing correlations at 217.5E
Computing correlations at 222.5E
Computing correlations at 227.5E
Computing correlations at 232.5E
Computing correlations at 237.5E
Computing correlations at 242.5E
Computing correlations at 247.5E
Computing correlations at 252.5E
Computing correlations at 257.5E
Computing correlations at 262.5E
Computing correlations at 267.5E
Computing correlations at 272.5E
Computing correlations at 277.5E
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pvals</span> <span class="o">=</span> <span class="n">pval</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="c1"># make the p-value array a 1D one</span>
<span class="n">pvec</span> <span class="o">=</span> <span class="n">pvals</span><span class="p">[</span><span class="n">pvals</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># restrict to valid probabilities as there are a few weird values.</span>
<span class="n">nt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pvec</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nt</span><span class="p">))</span> <span class="c1"># check on the final number</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>328
</pre></div>
</div>
</div>
</div>
<p>We found 328 with enough data for a meaningful comparison, and 23 locations that pass the test. Where are they? To gain insight, let us plot the correlations and indicate (by shading) which are deemed significant:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
<span class="kn">import</span> <span class="nn">cartopy.feature</span> <span class="k">as</span> <span class="nn">cfeature</span>
<span class="kn">from</span> <span class="nn">cartopy.mpl.ticker</span> <span class="kn">import</span> <span class="n">LongitudeFormatter</span><span class="p">,</span> <span class="n">LatitudeFormatter</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="n">land_color</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">xkcd_rgb</span><span class="p">[</span><span class="s1">&#39;light grey&#39;</span><span class="p">]</span>
<span class="n">ocean_color</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">xkcd_rgb</span><span class="p">[</span><span class="s1">&#39;light grey&#39;</span><span class="p">]</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="mi">180</span><span class="p">))</span>

<span class="c1"># map</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">LAND</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">land_color</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">land_color</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">OCEAN</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">ocean_color</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">ocean_color</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>

<span class="n">transform</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>
<span class="n">latlon_range</span> <span class="o">=</span> <span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="mi">280</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">70</span><span class="p">)</span>
<span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">,</span> <span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span> <span class="o">=</span> <span class="n">latlon_range</span>
<span class="n">lon_ticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">60</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">300</span><span class="p">]</span>
<span class="n">lat_ticks</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="o">-</span><span class="mi">45</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">90</span><span class="p">]</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">(</span><span class="n">latlon_range</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">transform</span><span class="p">)</span>
<span class="n">lon_formatter</span> <span class="o">=</span> <span class="n">LongitudeFormatter</span><span class="p">(</span><span class="n">zero_direction_label</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">lat_formatter</span> <span class="o">=</span> <span class="n">LatitudeFormatter</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">lon_formatter</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">lat_formatter</span><span class="p">)</span>
<span class="n">lon_ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lon_ticks</span><span class="p">)</span>
<span class="n">lat_ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lat_ticks</span><span class="p">)</span>
<span class="n">mask_lon</span> <span class="o">=</span> <span class="p">(</span><span class="n">lon_ticks</span> <span class="o">&gt;=</span> <span class="n">lon_min</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lon_ticks</span> <span class="o">&lt;=</span> <span class="n">lon_max</span><span class="p">)</span>
<span class="n">mask_lat</span> <span class="o">=</span> <span class="p">(</span><span class="n">lat_ticks</span> <span class="o">&gt;=</span> <span class="n">lat_min</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat_ticks</span> <span class="o">&lt;=</span> <span class="n">lat_max</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">lon_ticks</span><span class="p">[</span><span class="n">mask_lon</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="n">transform</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">lat_ticks</span><span class="p">[</span><span class="n">mask_lat</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="n">transform</span><span class="p">)</span>

<span class="c1"># contour</span>
<span class="n">clevs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mi">19</span><span class="p">)</span>
<span class="c1">#corr_r, lon_r = rotate_lon(corr.T, lon)  # rotate the field to make longitude in increasing order and convert to range (0, 360)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">ds_sel</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span> <span class="n">ds_sel</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span> <span class="n">corr</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">clevs</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu_r&#39;</span><span class="p">,</span> <span class="n">extend</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span>

<span class="c1"># significant points</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">slon</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">slat</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;purple&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">)</span> 


<span class="c1"># colorbar</span>
<span class="n">cbar_pad</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">cbar_orientation</span> <span class="o">=</span> <span class="s1">&#39;vertical&#39;</span>
<span class="n">cbar_aspect</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">cbar_fraction</span> <span class="o">=</span> <span class="mf">0.15</span>
<span class="n">cbar_shrink</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">cbar_title</span> <span class="o">=</span> <span class="s1">&#39;R&#39;</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="n">cbar_orientation</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="n">cbar_pad</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="n">cbar_aspect</span><span class="p">,</span>
                    <span class="n">fraction</span><span class="o">=</span><span class="n">cbar_fraction</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="n">cbar_shrink</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">cbar_title</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;R&#39;)
</pre></div>
</div>
<img alt="../_images/5a3c67a5e5fa0bf6c916281096312d494c19fb1ef52396be6975f1bee956f465.png" src="../_images/5a3c67a5e5fa0bf6c916281096312d494c19fb1ef52396be6975f1bee956f465.png" />
</div>
</div>
<p>The purple dots on the map are the locations of the gridpoints where the p-values fall under 5%, and they naturally correspond to the regions of highest correlations, though (and this is suspicious) they are rather randomly scattered across the domain.<br />
We might be tempted to declare victory and hail them as “significant”, but this is a well-known problem: the Multiple Hypothesis problem, otherwise known as the “look elsewhere” effect.</p>
<p>Conducting tests at the 5% level (what most people would call “the 95% confidence level”) specifically means that we expect 5% of our tests to return spurious results, just from chance alone (the so-called “type I error”). We just carried out 327 tests, so we expect <span class="math notranslate nohighlight">\(0.05*327 \approx 16 \)</span> of those results to be false positives, right out of the gate.  So which of the 23 tests labeled as significant can we trust? One way to approach this is to rank order the p-values of all 327 tests and plot them as in Hu et al (2017), Fig 2.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#check i/m vs. p-values</span>
<span class="n">indexm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nt</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">*</span><span class="n">indexm</span> <span class="o">/</span> <span class="n">nt</span>
<span class="n">thres</span> <span class="o">=</span> <span class="mf">0.05</span><span class="o">*</span><span class="n">im</span>
<span class="n">pvec_s</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">pvec</span><span class="p">)</span>
<span class="n">smaller</span><span class="o">=</span><span class="p">[]</span>
<span class="n">small_index</span><span class="o">=</span><span class="p">[]</span>
<span class="n">larger</span><span class="o">=</span><span class="p">[]</span>
<span class="n">large_index</span><span class="o">=</span><span class="p">[]</span>

<span class="n">n</span><span class="o">=</span><span class="mi">0</span>
<span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pvec_s</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">pp</span> <span class="o">&lt;=</span><span class="mf">0.05</span><span class="p">:</span>
        <span class="n">smaller</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pp</span><span class="p">)</span>
        <span class="n">small_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">im</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">larger</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pp</span><span class="p">)</span>
        <span class="n">large_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">im</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
    <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span>

<span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">im</span><span class="p">,</span><span class="n">thres</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;FDR threshold&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">small_index</span><span class="p">,</span><span class="n">smaller</span><span class="p">,</span><span class="s1">&#39;ro&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;p-values below threshold&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">large_index</span><span class="p">,</span><span class="n">larger</span><span class="p">,</span><span class="s1">&#39;ko&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;p-values above threshold&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;silver&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;5% threshold&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$i/n_t$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$p_i$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Correlation p-values&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x32b616590&gt;
</pre></div>
</div>
<img alt="../_images/5e87bdeacef6d794a9862fe8842b5aefbf12cc21726e38b2e064b8085dad668f.png" src="../_images/5e87bdeacef6d794a9862fe8842b5aefbf12cc21726e38b2e064b8085dad668f.png" />
</div>
</div>
<p>One solution to this is the False Discovery Rate (aka <strong>FDR</strong>), which was devised in a celebrated 1995 paper <a class="reference external" href="https://rss.onlinelibrary.wiley.com/doi/abs/10.1111/j.2517-6161.1995.tb02031.x">(Benjamini &amp; Hochberg, 1995)</a>. The idea is to look not just for the p-values under 5% (red dots in the figure above), but for the fraction of those under the blue line, which guards against the false discoveries one expects out of repeatedly testing the same hypothesis over and over again. To access this functionality in <code class="docutils literal notranslate"><span class="pre">pyleoclim</span></code> , one may do:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fdr_res</span> <span class="o">=</span> <span class="n">pyleo</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">correlation</span><span class="o">.</span><span class="n">fdr</span><span class="p">(</span><span class="n">pvec_s</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fdr_res</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>None
</pre></div>
</div>
</div>
</div>
<p>And with this treatment, exactly 0 gridpoints pass the test.</p>
<p>Does this depend on our method for evaluating significance? That is easy to check:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pval2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">nlon</span><span class="p">,</span><span class="n">nlat</span><span class="p">))</span> <span class="c1"># declare array to store pvalues</span>
<span class="n">corr2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">pval</span><span class="p">)</span> <span class="c1"># declare empty array of identical shape</span>
<span class="n">slon</span><span class="p">,</span> <span class="n">slat</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[];</span>
<span class="n">sst_list</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># initialize empty list </span>

<span class="k">for</span> <span class="n">ji</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nlon</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Computing correlations at &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ds_sel</span><span class="o">.</span><span class="n">longitude</span><span class="p">[</span><span class="n">ji</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nlat</span><span class="p">):</span>  
        <span class="n">st</span> <span class="o">=</span> <span class="n">ds_sel</span><span class="p">[</span><span class="s1">&#39;tos&#39;</span><span class="p">][:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ji</span><span class="p">]</span>
        <span class="n">climatology</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;time.month&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
        <span class="n">anomalies</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;time.month&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="n">climatology</span>
        <span class="n">st_annual</span> <span class="o">=</span> <span class="n">anomalies</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;time.year&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
        <span class="c1">#  test if at least 100 non-NaNs</span>
        <span class="n">noNaNs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">st_annual</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># number of valid years</span>
        <span class="n">sstvar</span> <span class="o">=</span> <span class="n">st_annual</span><span class="o">.</span><span class="n">var</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">noNaNs</span> <span class="o">&gt;=</span> <span class="mi">100</span> <span class="ow">and</span> <span class="n">sstvar</span> <span class="o">&gt;=</span> <span class="mf">0.01</span><span class="p">:</span>
            <span class="n">sttb</span> <span class="o">=</span> <span class="n">pyleo</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">st_annual</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                        <span class="n">time_unit</span> <span class="o">=</span><span class="s1">&#39;year CE&#39;</span><span class="p">,</span> 
                        <span class="n">value</span><span class="o">=</span><span class="n">st_annual</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                        <span class="n">value_unit</span> <span class="o">=</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">sst_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sttb</span><span class="p">)</span> 
            <span class="n">corr_res</span> <span class="o">=</span> <span class="n">sttb</span><span class="o">.</span><span class="n">correlation</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;phaseran&#39;</span><span class="p">,</span><span class="n">number</span> <span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="n">seed</span><span class="o">=</span><span class="mi">333</span><span class="p">,</span> <span class="n">mute_pbar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">pval2</span><span class="p">[</span><span class="n">ji</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">corr_res</span><span class="o">.</span><span class="n">p</span>
            <span class="n">corr2</span><span class="p">[</span><span class="n">ji</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">corr_res</span><span class="o">.</span><span class="n">r</span>
            <span class="k">if</span> <span class="n">pval2</span><span class="p">[</span><span class="n">ji</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">alpha</span><span class="p">:</span>
                <span class="n">slon</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ds_sel</span><span class="o">.</span><span class="n">longitude</span><span class="p">[</span><span class="n">ji</span><span class="p">])</span>
                <span class="n">slat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ds_sel</span><span class="o">.</span><span class="n">latitude</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>  
            <span class="n">pval2</span><span class="p">[</span><span class="n">ji</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">;</span> <span class="n">corr2</span><span class="p">[</span><span class="n">ji</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Computing correlations at 122.5E
Computing correlations at 127.5E
Computing correlations at 132.5E
Computing correlations at 137.5E
Computing correlations at 142.5E
Computing correlations at 147.5E
Computing correlations at 152.5E
Computing correlations at 157.5E
Computing correlations at 162.5E
Computing correlations at 167.5E
Computing correlations at 172.5E
Computing correlations at 177.5E
Computing correlations at 182.5E
Computing correlations at 187.5E
Computing correlations at 192.5E
Computing correlations at 197.5E
Computing correlations at 202.5E
Computing correlations at 207.5E
Computing correlations at 212.5E
Computing correlations at 217.5E
Computing correlations at 222.5E
Computing correlations at 227.5E
Computing correlations at 232.5E
Computing correlations at 237.5E
Computing correlations at 242.5E
Computing correlations at 247.5E
Computing correlations at 252.5E
Computing correlations at 257.5E
Computing correlations at 262.5E
Computing correlations at 267.5E
Computing correlations at 272.5E
Computing correlations at 277.5E
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pvals2</span> <span class="o">=</span> <span class="n">pval2</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="c1"># make the p-value array a 1D one</span>
<span class="n">pvec2</span> <span class="o">=</span> <span class="n">pvals2</span><span class="p">[</span><span class="n">pvals2</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># restrict to valid probabilities as there are a few weird values.</span>
<span class="n">fdr_res2</span> <span class="o">=</span> <span class="n">pyleo</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">correlation</span><span class="o">.</span><span class="n">fdr</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">pvec2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fdr_res2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>None
</pre></div>
</div>
</div>
</div>
<p>Here 1 grid point emerges as significant with this method. Now, another way we could have done this is to bundle all SST series from each grid point as a MultipleSeries object, and let the <code class="docutils literal notranslate"><span class="pre">CorrEns</span></code> class do its magic. This allows to directly compute the correlation between objects, and leverage the <a class="reference external" href="https://pyleoclim-util.readthedocs.io/en/latest/core/api.html#correns-pyleoclim-correns">CorrEns class</a> and its plotting method:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sstMS</span> <span class="o">=</span> <span class="n">pyleo</span><span class="o">.</span><span class="n">MultipleSeries</span><span class="p">(</span><span class="n">sst_list</span><span class="p">)</span>
<span class="n">corr_ens</span> <span class="o">=</span> <span class="n">sstMS</span><span class="o">.</span><span class="n">correlation</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;phaseran&#39;</span><span class="p">,</span><span class="n">number</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="n">seed</span><span class="o">=</span><span class="mi">333</span><span class="p">,</span><span class="n">mute_pbar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Looping over 328 Series in collection
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2807.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2845.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2831.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2831.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2868.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2883.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2884.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2883.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2887.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2881.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2877.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2845.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2893.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2882.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2872.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2894.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2859.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2862.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2136.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2890.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2874.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2871.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2883.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2877.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2860.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2864.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2870.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2887.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2867.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2882.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2876.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2876.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2867.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2853.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2853.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2868.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2892.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2878.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2892.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2865.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2871.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2878.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2884.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2880.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2854.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2867.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2863.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2847.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2877.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2860.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2853.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2861.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2872.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2852.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2870.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2891.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2877.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2887.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2895.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2869.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2879.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2876.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2859.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2851.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2858.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2876.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2880.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2868.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2866.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2877.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2832.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2098.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2833.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2837.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2850.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2863.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2838.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2872.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2865.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2853.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2874.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2878.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2867.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2881.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2842.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2840.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2204.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2863.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2853.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2842.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2876.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2851.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2831.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2852.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2887.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2878.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2866.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2866.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2881.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2867.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2832.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2844.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2873.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2877.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2825.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2873.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2853.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2838.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2861.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2892.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2879.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2863.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2842.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2844.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2866.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2840.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2851.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2866.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2864.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2859.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2859.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2861.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2840.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2870.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2881.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2880.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2849.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2864.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2868.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2868.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2872.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2853.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2853.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2866.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2844.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2833.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2865.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2852.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2871.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2140.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2882.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2851.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2834.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2825.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2843.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2844.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2827.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2890.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2891.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2824.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2882.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2867.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2884.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2862.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2212.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2897.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2864.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2838.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2837.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2872.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2821.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2806.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2648.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2823.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2731.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2620.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2826.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2581.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2840.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2800.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2872.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2852.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2789.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2794.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2396.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2746.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2829.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2872.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2859.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2866.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2849.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2861.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2847.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2793.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2848.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2849.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2823.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2842.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2846.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2851.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2831.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2808.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2663.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2863.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2634.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2828.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2830.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2826.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2863.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2809.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2865.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2836.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2846.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2845.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2847.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2846.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2821.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2134.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2865.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2649.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2844.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2826.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2844.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2812.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2817.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2861.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2841.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2842.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2820.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2854.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2852.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2830.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2121.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2844.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2833.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2855.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2830.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2818.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2852.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2654.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2869.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2800.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2824.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2820.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2831.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2861.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2564.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2812.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2811.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2858.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2842.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2530.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2869.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2799.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2844.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2877.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2860.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2870.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2862.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2834.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2856.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2855.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2850.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2878.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2868.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2841.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2809.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2835.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2864.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2852.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2852.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2717.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2880.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2856.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2854.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2847.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2848.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2853.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2804.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2836.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2850.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2840.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2863.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2830.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2786.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 1895.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2404.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2504.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2833.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2873.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2847.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2801.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2774.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2861.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2840.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2853.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2858.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2856.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2858.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2865.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2854.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2867.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2843.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2864.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2702.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2478.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2829.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2674.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2869.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2869.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2839.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2873.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2883.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2870.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2820.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2880.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2908.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2890.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2919.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2926.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2912.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2902.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2889.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2907.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2865.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2841.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2905.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2916.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2945.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2957.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2947.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2967.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2926.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2906.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2934.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2839.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2836.
Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2656.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr_ens</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 400x400 with 1 Axes&gt;, &lt;Axes: xlabel=&#39;$r$&#39;, ylabel=&#39;Count&#39;&gt;)
</pre></div>
</div>
<img alt="../_images/1415f4bf31391a0f799339b5a90378b86e6845b86ecbb861f0cce7aca8d31f39.png" src="../_images/1415f4bf31391a0f799339b5a90378b86e6845b86ecbb861f0cce7aca8d31f39.png" />
</div>
</div>
<p>To save this figure, there are several ways. The <a class="reference external" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.savefig.html">standard matplotlib way</a> would look like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;CrystalCave_field_corr_hist.pdf&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The file format is inferred form the filename, but the default resolution may be too low for publication. In addition, setting the legend to the right has expanded the figure’s bounding box, but <code class="docutils literal notranslate"><span class="pre">savefig</span></code> doesn’t know about that, and will crop the result, wasting our effort. These two problems may be remedied thus:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;CrystalCave_field_corr_hist.pdf&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Alternatively, users may pass a dictionary called <code class="docutils literal notranslate"><span class="pre">savefig_settings</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr_ens</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">savefig_settings</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;path&#39;</span><span class="p">:</span><span class="s1">&#39;CrystalCave_field_corr_hist.pdf&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Figure saved at: &quot;CrystalCave_field_corr_hist.pdf&quot;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 400x400 with 1 Axes&gt;, &lt;Axes: xlabel=&#39;$r$&#39;, ylabel=&#39;Count&#39;&gt;)
</pre></div>
</div>
</div>
</div>
<p>By default, it sets the dpi to 300 and <code class="docutils literal notranslate"><span class="pre">bbox_inches='tight'</span></code>, so the path is the only thing that need be specified. Note that in this case the</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr_ens</span><span class="o">.</span><span class="n">signif_fdr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0
</pre></div>
</div>
</div>
</div>
<p>We find the same result as before, though in a much more compact form. Note, however, that this method does not keep track of where the significant points are (it does not have a notion of what “where” means), so if you wanted to draw a map like the one above, you would be better off with the loop previously shown.</p>
</section>
<section id="pitfall-3-age-uncertainties">
<h2>Pitfall #3: Age uncertainties<a class="headerlink" href="#pitfall-3-age-uncertainties" title="Link to this heading">#</a></h2>
<p>The first two pitfalls notwithstanding, there is a third difficulty in this comparison: beautiful though U/Th chronologies may be, they harbor uncertainties too, and such chronological uncertainties must be taken into account. The LiPD file provided with this notebook contains not only the raw U/Th dates and the published ages, but also an ensemble of age-depth relationships derived from those dates, via the Bayesian age model <a class="reference external" href="https://cran.r-project.org/web/packages/Bchron/vignettes/Bchron.html">BChron</a> (Haslett &amp; Parnell, 2008). Let us load those 1000 draws from the posterior distribution of ages and put them in an object where <code class="docutils literal notranslate"><span class="pre">Pyleoclim</span></code> will be able to work with them. To do so, we will call upon the <code class="docutils literal notranslate"><span class="pre">PyLiPD</span></code> package to manipulate the LiPD file.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ensemble_df</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">get_ensemble_tables</span><span class="p">()</span>
<span class="n">ensemble_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>datasetName</th>
      <th>ensembleTable</th>
      <th>ensembleVariableName</th>
      <th>ensembleVariableValues</th>
      <th>ensembleVariableUnits</th>
      <th>ensembleDepthName</th>
      <th>ensembleDepthValues</th>
      <th>ensembleDepthUnits</th>
      <th>notes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Crystal.McCabe-Glynn.2013</td>
      <td>http://linked.earth/lipd/Crystal.McCabe-Glynn....</td>
      <td>Year</td>
      <td>[[2007.0, 2007.0, 2008.0, 2007.0, 2007.0, 2007...</td>
      <td>yr AD</td>
      <td>depth</td>
      <td>[0.1, 0.15, 0.2, 0.25, 0.3, 0.35, 0.4, 0.45, 0...</td>
      <td>mm</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cc_ens</span> <span class="o">=</span> <span class="n">pyleo</span><span class="o">.</span><span class="n">EnsembleGeoSeries</span><span class="o">.</span><span class="n">from_AgeEnsembleArray</span><span class="p">(</span><span class="n">geo_series</span><span class="o">=</span><span class="n">cc</span><span class="p">,</span> <span class="n">age_array</span><span class="o">=</span> <span class="n">ensemble_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;ensembleVariableValues&#39;</span><span class="p">],</span>
                                                     <span class="n">age_depth</span> <span class="o">=</span> <span class="n">ensemble_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;ensembleDepthValues&#39;</span><span class="p">],</span> 
                                                     <span class="n">value_depth</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The resulting object is an <code class="docutils literal notranslate"><span class="pre">EnsembleGeoSeries</span></code>, a special case of <code class="docutils literal notranslate"><span class="pre">MultipleGeoSeries</span></code> where all constituent series have the same units There are two ways to plot this ensemble. First, as a series of traces:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">cc_ens</span><span class="o">.</span><span class="n">plot_traces</span><span class="p">()</span>
<span class="n">cc</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;Time [yr AD]&#39;, ylabel=&#39;$\\delta^{18}O$ [‰]&#39;&gt;
</pre></div>
</div>
<img alt="../_images/676b941b5fa45cf085f1549f5ba1a16ef03e8c5d9df5e34be4d9ec5c78dfe9f1.png" src="../_images/676b941b5fa45cf085f1549f5ba1a16ef03e8c5d9df5e34be4d9ec5c78dfe9f1.png" />
</div>
</div>
<p>It is quite plain that any of the record’s main swings can be swung back and forth by up to decades. Another way to see this is to plot various quantiles as an envelope:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">cc_ens</span><span class="o">.</span><span class="n">common_time</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;interp&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot_envelope</span><span class="p">(</span><span class="n">ylabel</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">value_name</span><span class="p">)</span>
<span class="n">cc</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;Time [yr AD]&#39;, ylabel=&#39;$\\delta^{18}O$ [‰]&#39;&gt;
</pre></div>
</div>
<img alt="../_images/eb20d9d31fa7163b52fca2c67017937979867bfdd046ef34e261dc28fe5b803c.png" src="../_images/eb20d9d31fa7163b52fca2c67017937979867bfdd046ef34e261dc28fe5b803c.png" />
</div>
</div>
<p>Notice how the quantiles are computed over only part of the interval covered by the original series; that is because some age models end up being more compressed or stretched out than the original, and we need a common interval to compute quantiles. In particular, notice how the base of the record could really be anywhere between 850 and 1100 AD.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cc_ens</span><span class="o">.</span><span class="n">dashboard</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Performing spectral analysis on individual series: 100%|█| 1000/1000 [00:17&lt;00:0
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 1100x800 with 4 Axes&gt;,
 {&#39;ts&#39;: &lt;Axes: xlabel=&#39;Time [yr AD]&#39;, ylabel=&#39;$\\delta^{18}O$ [‰]&#39;&gt;,
  &#39;dts&#39;: &lt;Axes: xlabel=&#39;Counts&#39;&gt;,
  &#39;map&#39;: {&#39;map&#39;: &lt;GeoAxes: xlabel=&#39;lon&#39;, ylabel=&#39;lat&#39;&gt;},
  &#39;spec&#39;: &lt;Axes: xlabel=&#39;Period [yr AD]&#39;, ylabel=&#39;PSD&#39;&gt;})
</pre></div>
</div>
<img alt="../_images/91a03502eef20e998c5a9fc19a369c3c151ea0fa33840ba69630a21cdb04aa3b.png" src="../_images/91a03502eef20e998c5a9fc19a369c3c151ea0fa33840ba69630a21cdb04aa3b.png" />
</div>
</div>
<p>Now, what we’d like to do is repeat the exercise of Part 1, correlating the same SST timeseries from 32.5N 142.5W (near the Kuroshio Extension), not just with the published chronology, but this whole ensemble. Remember how we had computed things:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr_res</span> <span class="o">=</span> <span class="n">stts</span><span class="o">.</span><span class="n">correlation</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span> <span class="n">seed</span> <span class="o">=</span> <span class="mi">22</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">corr_res</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2857.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  correlation    p-value  signif. (α: 0.05)
-------------  ---------  -------------------
     0.323596       0.12  False
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<p>Though of course, we could have done just the reverse, as correlation is a symmetric operator:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr_res</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">correlation</span><span class="p">(</span><span class="n">stts</span><span class="p">,</span> <span class="n">seed</span> <span class="o">=</span> <span class="mi">22</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">corr_res</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating association on surrogate pairs: 100%|█| 1000/1000 [00:00&lt;00:00, 2201.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  correlation    p-value  signif. (α: 0.05)
-------------  ---------  -------------------
     0.323596       0.12  False
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<p>Now, consider the task ahead: a user must iterate over all ensemble members, taking care of aligning their time axis to that of HadSST4; you must compute the correlation and establish its significance with a sensible test (Pitfall #1), watching out for test multiplicity (see Pitfall #2) <em>and</em>  visualizing the results in an intuitive way. <code class="docutils literal notranslate"><span class="pre">pyleoclim</span></code> simplifies this process, which illustrate here for the Kuroshio Extension location as above.  To keep computing time manageable, we reduce the number of isospectral simulations to 500, and correlate the ensemble and the SST series we started with:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr_Kuroshio</span> <span class="o">=</span> <span class="n">cc_ens</span><span class="o">.</span><span class="n">correlation</span><span class="p">(</span><span class="n">stts</span><span class="p">,</span><span class="n">number</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span><span class="n">seed</span> <span class="o">=</span> <span class="mi">453</span><span class="p">)</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Looping over 1000 Series in the ensemble
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0%|                                          | 2/1000 [00:00&lt;01:13, 13.59it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Time axis values sorted in ascending order
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|███████████████████████████████████████| 1000/1000 [01:06&lt;00:00, 15.10it/s]
</pre></div>
</div>
</div>
</div>
<p>Again <code class="docutils literal notranslate"><span class="pre">corr_Kuroshio</span></code> is a <code class="docutils literal notranslate"><span class="pre">CorrEns</span></code> object, which contains everything you want: the vector of correlations, the p-values, <em>and</em> a method to plot them all:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr_Kuroshio</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 400x400 with 1 Axes&gt;, &lt;Axes: xlabel=&#39;$r$&#39;, ylabel=&#39;Count&#39;&gt;)
</pre></div>
</div>
<img alt="../_images/0f482dd1ac9eb973c5102f322f837633fc816a37dafcc9495b87e432a438fdb4.png" src="../_images/0f482dd1ac9eb973c5102f322f837633fc816a37dafcc9495b87e432a438fdb4.png" />
</div>
</div>
<p>Several things jump out at once:</p>
<ol class="arabic simple">
<li><p>the correlation histogram is relatively symmetric, meaning that age uncertainties are able to completely overturn the original correlation of about 0.32 : nearly half of the ensemble exhibits negative correlations with SST).</p></li>
<li><p>As shown in teal, only ~4% of the 500*100 correlations just computed are judged significant.</p></li>
<li><p>Once we take test multiplicity into account via the False Discovery Rate (orange bar), only a fraction of a %  is deemed significant.</p></li>
</ol>
<p>To save the figure:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr_Kuroshio</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">savefig_settings</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;path&#39;</span><span class="p">:</span><span class="s1">&#39;CrystalCave_ageens_corr_hist.pdf&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Figure saved at: &quot;CrystalCave_ageens_corr_hist.pdf&quot;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 400x400 with 1 Axes&gt;, &lt;Axes: xlabel=&#39;$r$&#39;, ylabel=&#39;Count&#39;&gt;)
</pre></div>
</div>
</div>
</div>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Link to this heading">#</a></h2>
<p>We see, as in Hu et al (2017), that all of these pitfalls matter. Any single one of them can turn a correlation initially reported as significant into an insignificant one, and the picture worsens if these pitfalls compound one another. The conjunction of all 3 pitfalls (persistence, test multiplicity, and age uncertainties) is particularly damaging in this example, invalidating the published interpretation of Crystal Cave <span class="math notranslate nohighlight">\(\delta^{18}O\)</span> as a proxy for Kuroshio Extension SST.</p>
<p>Pyleoclim makes it easy to deal with those pitfalls, which we hoped will help avoid spurious correlations in paleoclimatology and paleoceanography. It bears emphasizing, as Hu et al (2017) did, that a significant linear correlation is neither necessary nor sufficient a condition to establish the interpretation of a proxy series, and that mechanistic models or <em>in situ</em> monitoring are generally needed.</p>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Benjamini, Y., and Y. Hochberg (1995), Controlling the false discovery rate: A practical and powerful approach to multiple testing, Journal of the Royal Statistical Society. Series B (Methodological), 57(1), 289–300, doi:10.2307/2346101.</p></li>
<li><p>Dawdy, D., and N. Matalas (1964), Statistical and probability analysis of hydro- logic data, part III: Analysis of variance, covariance and time series, McGraw-Hill.</p></li>
<li><p>Ebisuzaki, W. (1997), A method to estimate the statistical significance of a correlation when the data are serially correlated, Journal of Climate, 10(9), 2147–2153, doi:10.1175/1520- 0442(1997)010¡2147:AMTETS¿<a class="reference external" href="http://2.0.CO">2.0.CO</a>;2</p></li>
<li><p>Gelman, A., and H. Stern (2006), The difference between “significant” and “not significant” is not itself statistically significant, The American Statistician, 60(4), 328–331, doi: 10.1198/000313006X152649.</p></li>
<li><p>Haslett, J., and A. Parnell (2008), A simple monotone process with application to radiocarbon-dated depth chronologies, Journal of the Royal Statistical Society: Series C (Applied Statistics), 57(4), 399–418, doi:10.1111/j.1467-9876.2008.00623.x.</p></li>
<li><p>Hu, J., J. Emile-Geay, and J. Partin (2017), Correlation-based interpretations of paleoclimate data – where statistics meet past climates, Earth and Planetary Science Letters, 459, 362–371, doi:10.1016/j.epsl.2016.11.048</p></li>
<li><p>McCabe-Glynn, S., K. R. Johnson, C. Strong, M. Berkelhammer, A. Sinha, H. Cheng, and R. L. Edwards (2013), Variable North Pacific influence on drought in southwestern North America since AD 854, Nat. Geosci., 6(8), 617–621, doi:10.1038/NGEO1862.</p></li>
<li><p>Morice, C. P., J. J. Kennedy, N. A. Rayner, and P. D. Jones (2012), Quantifying uncertainties in global and regional temperature change using an ensemble of observational estimates: The HadCRUT4 data set, Journal of Geophysical Research: Atmospheres, 117(D8), n/a–n/a, doi:10.1029/2011JD017187.</p></li>
<li><p>Rehfeld, K., and J. Kurths (2014), Similarity estimators for irregular and age-uncertain time series, Climate of the Past, 10(1), 107–122, doi:10.5194/cp-10-107-2014</p></li>
<li><p>Wilks, D. S. (2011), Statistical Methods in the Atmospheric Sciences: an Introduction, 676 pp., Academic Press, San Diego</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./CrystalCorrelations"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../MDConfrontation/Model_data_confrontation.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Model-Data Confrontation in the Spectral Domain</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data">Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-exploration">Data Exploration</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sea-surface-temperature">Sea-surface Temperature</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pitfall-1-persistence">Pitfall #1: Persistence</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#null-models">Null Models</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#timeseries-alignment">Timeseries Alignment</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pitfall-2-multiple-hypothesis-testing">Pitfall #2: Multiple Hypothesis Testing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pitfall-3-age-uncertainties">Pitfall #3: Age uncertainties</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion">Conclusion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Deborah Khider
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>